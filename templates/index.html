{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-lg-12">
            <!-- Форма для поиска, фильтрации по дате и типу мероприятия -->
            <form class="form-inline mb-4" action="{{ url_for('index') }}" method="GET">
                <input class="form-control mr-sm-2" type="search" placeholder="Поиск..." aria-label="Search"
                    name="search">
                <input class="form-control mr-sm-2" type="date" name="date" id="date-filter">
                <select class="form-control mr-sm-2" name="type" id="type-filter">
                    <option value="">Выберите тип мероприятия</option>
                    {% for event_type in event_types %}
                    <option value="{{ event_type }}">{{ event_type }}</option>
                    {% endfor %}
                </select>
                <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Искать</button>
            </form>
        </div>
    </div>
    {% for event_type, events_by_type in events_by_type.items() %}
    <div class="row">
        <div class="col-lg-12">
            <h2>{{ event_type }}</h2>
            {% for event in events_by_type %}
            <div >
                <div class="card shadow rounded" id="{{ event.id }}">
                    <br>
                    <div class="col-lg-10 col-md-10 mx-auto">
                        <div class="col-md-3 text-center">
                            <img src="{{ event.photo }}" class="card-img-top mx-auto d-block" alt="Photo"
                                style="max-height: 600px; width: auto">
                        </div>
                        <div class="card-body">
                            <h2 class="card-title">{{ event.name }}</h2>
                            <h3 class="card-subtitle mb-2 text-muted">{{ event.date_time }}</h3>
                            <p class="card-text">Type: {{ event.type }}</p>
                            <p class="card-text">Address: {{ event.address }}</p>
                            <p class="card-text">{{ event.info }}</p>
                        </div>
                        <div class="card-header text-right">
                            <form method="POST" action="/delete_event">
                                <input type="hidden" name="event_id" value="{{ event.id }}">
                                <button type="submit" class="btn btn-danger">Delete</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <hr>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}
<script>
    document.getElementById('date-filter').addEventListener('change', function() {
        this.form.submit(); // Автоматическая отправка формы при изменении даты
    });
    
    document.getElementById('type-filter').addEventListener('change', function() {
        this.form.submit(); // Автоматическая отправка формы при выборе типа мероприятия
    });
    </script>
